## UniFi Proxy 1.1.0
    18/01/2016
    
Основная функция getMetric() полностью переписана. Теперь вместо рекурсивного вызова при обходе JSON дерева используется стековая модель.

Введена обработка всех найденных на контроллере сайтов в том случае, если в запросе имя сайта не указано.

Добавлены новые действия:
- psum - вычисление процента суммы значений подпадающих под фильтр JSON-ключей от общей суммы.
- pcount - вычисление процента количества значений подпадающих под фильтр JSON-ключей от общего количества.

Для ключей-фильтров доступны:
- логическая операция _&_ (_and_)  - фильтр считается пройденным при выполнении всех условий;
- логическая операция _|_ (_or_)  - фильтр считается пройденным при выполнении любого условия;
- состояние равенства в условии _=_;
- состояние неравенства в условии _<>_ .

Добавлены новые объекты:
- alluser - все пользователи в базе данных (объект user определяет только активных пользователей);
- health - состояние контроллера UniFi (см. дашбоард в v4);
- setting - некоторые настройки контроллера (Settings -> Site);
- network - определенные на контроллере сети (Settings -> Networks);
- usergroup - пользовательские группы (Settings -> User Groups);
- sysinfo - некоторая системная информация;
- number - информация о сопоставленных voip-устройствам абонентских номерах;
- extension - информация о зарегистрированных на контроллере voip-устройствах.

Введена возможность получения LLD-JSON с произвольного поддерева JSON. Обрабатываемые на текущий момент объекты:
- uap_vap_table - список виртуальных точек доступа в пределах заданной UAP;
- usw_port_table - таблица портов UniFi Switch;

### Примеры

LLD-JSON для всех UAP для сайта "default"

    ./unifi_proxy_get 127.0.0.1 8448 "discovery,uap,default"

LLD-JSON для всех UAP во всех сайтах контроллера

    ./unifi_proxy_get 127.0.0.1 8448 "discovery,uap"

Количество активных пользователей во всех сайтах контроллера

    ./unifi_proxy_get 127.0.0.1 8448 "sum,site,,num_sta"

Количество активных UAP во всех сайтах контроллера

    ./unifi_proxy_get 127.0.0.1 8448 "count,uap,,[state=1].state"

Процент активных UAP от их общего числа во всех сайтах контроллера

    ./unifi_proxy_get 127.0.0.1 8448 "pcount,uap,,[state=1].state"

Процент траффика, генерируемого гостевыми виртуальными точками доступа

    ./unifi_proxy_get 127.0.0.1 8448 "psum,uap,,vap_table.[is_guest=1].rx_bytes"

Процент активных пользователей, поключенных с помощью продукции фирмы Apple

    ./unifi_proxy_get 127.0.0.1 8448 "pcount,user,,[oui=Apple].oui"

Процент активных пользователей, поключенных с помощью любых иных устройств, кроме продукции фирмы Apple.

    ./unifi_proxy_get 127.0.0.1 8448 "pcount,user,,[oui<>Apple].oui"

Процент когда-либо подключавшихся пользователей, использовавших продукцию фирмы Apple или Samsung.

    ./unifi_proxy_get 127.0.0.1 8448 "pcount,user,,[oui=Apple|oui=SamsungE].oui"

Версия ПО контроллера UniFi
    
    ./unifi_proxy_get 127.0.0.1 8448 "get,sysinfo,,version"

Состояние модуля WLAN, отображаемого на dashboard веб-интерфейса контроллера UniFi
    
    ./unifi_proxy_get 127.0.0.1 8448 "get,health,default,[subsystem=wlan].status"

Количество активных пользователей, зарегистрированных модулем WLAN
    
    ./unifi_proxy_get 127.0.0.1 8448 "get,health,default,[subsystem=wlan].num_user"

LLD-JSON для VOIP-устройств, зарегистрированных на контроллере
    
    ./unifi_proxy_get 127.0.0.1 8448 "discovery,extension,default"

Абонентский номер VOIP-устройства, ассоциированный с extension с заданным ID

    ./unifi_proxy_get 127.0.0.1 8448 "get,number,default,[extension_id=5698e7779932af54c74bad18].number"


-------------------

Core function getMetric() was reworked and built now on stack mechanism instead recursive self call on JSON tree traversal.
New actions:
- psum
- pcount
